function fetchServices(){$.n("Fetching available services..."),$.ajax({url:"services.json",dataType:"json"}).done(buildUI).fail(function(){$.n.error("Could not load service list. Please try reloading page.")})}function buildUI(e){$.n(e.length+" services available"),function(t,n,r,i,s){for(n=0,r=$("legend"),i=$('<div class="col"></div>').insertAfter(r);n<t;++n,r=i,i=$('<div class="col"></div>').insertAfter(r))for(s=n;s<e.length;s+=t)i.append('<div><label for="'+e[s]+'">'+'<input type="checkbox" id="'+e[s]+'">'+e[s]+"</label></div>")}(4),checkboxes=$('input[type="checkbox"]').extend({enable:function(){return this.each(function(){$(this).removeAttr("disabled")}),this},disable:function(){return this.each(function(){$(this).attr("disabled","disabled")}),this}}),buttons.build.disable().click(function(e){e.preventDefault(),build()}),$("form").delegate('form input[type="checkbox"]',"change",function(){var e=0;return function(){this.checked?e++:e--;if(typeof uglify=="undefined")return;e>0?buttons.build.enable():buttons.build.disable()}}()),Downloadify.create("button-bar",{filename:function(){return"jquery.lifestream.custom.min.js"},data:function(){return builtScript},onComplete:onDownloadComplete,onError:function(){alert("You must put something in the File Contents or there will be nothing to save!")},transparent:!1,swf:"js/downloadify.swf",downloadImage:"img/download.png",width:100,height:30,append:!0}),setTimeout(function(){buttons.download=$("#button-bar > object").extend({enable:function(){return this.css({visibility:"visible"}),this},disable:function(){return this.css({visibility:"hidden"}),this}}),buttons.download.disable()},0),$.n("Loading UglifyJS..."),$.getScript("js/uglifyjs-cs.min.js").fail(function(){$.n.error("Could not load UglifyJS. Please reload the page")}).done(function(){$.n("UglifyJS received")})}function build(){$.n("Build started"),checkboxes.disable(),buttons.build.disable(),buildScript($('input[type="checkbox"]').filter(":checked").map(function(){return $(this).attr("id")}).get(),onBuildCompleted,onBuildFailure)}function onBuildCompleted(e){$.n("Build completed"),builtScript=e,buttons.download.enable()}function onBuildFailure(){$.n.error("Build failed, please retry"),builtScript="",checkboxes.enable(),buttons.build.enable()}function onDownloadComplete(){checkboxes.enable(),buttons.download.disable(),buttons.build.enable()}function buildScript(e,t,n){function s(e,t,n){t=="abort"?$.n.error("Aborted "+this.url):$.n.error("Could not retrieve module "+this.url+": "+e.status)}var r=[],i=[];$.n("Fetching src modules..."),$.ajax({url:"../src/core.js",dataType:"text",cache:!1}).fail(function(e,t,r){s.apply(this,arguments),n()}).done(function(o){r.push(o),$.whenArray(i=$.map(e,function(e){return $.ajax({url:"../src/services/"+e+".js",dataType:"text",cache:!1}).done(function(e){r.push(e)}).fail(function(e,t,n){s.apply(this,arguments)})})).done(function(){$.n("All src moduled received"),$.n("Uglification..."),t(uglify(r.join(";")))}).fail(function(){var e,t;for(e=0;e<i.length;++e)t=i[e],t.isResolved()||t.abort();n()})})}function parseQueryString(){var e={};window.location.search.replace(new RegExp("([^?=&]+)(=([^&]*))?","g"),function(t,n,r,i){e[n]=i}),e.mock=e.mock==="true",e.mock?($.n("Fetching Mockjax..."),$.getScript("js/jquery.mockjax.min.js").fail(function(){$.n.warning("Could not load Mockjax")}).done(function(){$.n("Received Mockjax");var t={errorProb:.5,minTime:0,maxTime:1e4};e.errorProb&&(e.errorProb=Number(e.errorProb)),e.minTime&&(e.minTime=Number(e.minTime)),e.maxTime&&(e.maxTime=Number(e.maxTime)),$.extend(t,e),$.n("Start mocking: "+JSON.stringify(t)),$.mockjax(function(e){var n=Math.random()<t.errorProb,r={responseTime:t.minTime+Math.random()*(t.maxTime-t.minTime)};return n?r.status=404:r.proxy=e.url,r})}).always(fetchServices)):fetchServices()}var buttons={build:$("#button").extend({enable:function(){return this.removeAttr("disabled"),this},disable:function(){return this.attr("disabled","disabled"),this}}).disable(),download:undefined},checkboxes,builtScript="";$.whenArray=function(e){return $.when.apply(this,e)},$.n.defaults.timeout=16e3,parseQueryString();